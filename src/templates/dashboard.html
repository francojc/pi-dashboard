<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="refresh" content="{{ config.refresh_interval | default(900) }}">
    <title>Dashboard v2</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
    <!-- Weather Alert Banner -->
    {% if weather and weather.alerts and weather.alerts|length > 0 %}
    {% set alert = weather.alerts[0] %}
    <div class="weather-alert-banner
        {% if 'severe' in alert.event.lower() or 'warning' in alert.event.lower() %}
            {% if 'tornado' in alert.event.lower() or 'severe thunderstorm' in alert.event.lower() %}severe{% else %}warning{% endif %}
        {% endif %}">
        <div class="alert-content">
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span class="alert-event">{{ alert.event }}</span>
            <span class="alert-time">{{ alert.start }} - {{ alert.end }}</span>
        </div>
        <div class="alert-description">{{ alert.description }}</div>
    </div>
    {% endif %}

    <div class="dashboard-container">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="time-display">
                <div class="current-time">{{ current_time | default('14:32') }}</div>
                <div class="current-date">{{ day_name | default('Friday') }}, {{ date_info | default('July 4th, 2025') }}</div>
            </div>
            <div class="weather-hero">
                <div class="weather-main">
                    <div class="main-temp">{{ weather.temp | default('72') }}¬∞</div>
                    <div class="weather-desc">{{ weather.description | default('Partly Cloudy') }}</div>
                    <div class="weather-meta">
                        Feels like {{ weather.feels_like | default('75') }}¬∞
                    </div>
                </div>
                {% if weather and weather.icon %}
                <img src="https://openweathermap.org/img/wn/{{ weather.icon }}@4x.png"
                     alt="{{ weather.description }}" class="weather-icon-large">
                {% else %}
                <div class="weather-icon-large">‚õÖ</div>
                {% endif %}
            </div>
        </section>

        <!-- Main Content Grid -->
        <div class="content-grid">
            <!-- Left Column - Calendar Card -->
            <div class="left-column">
                <div class="card calendar-card">
                    <h2 class="card-title">Calendar</h2>

                    <div class="calendar-header-info">
                        <div class="week-info">Week {{ week_number | default('27') }}</div>
                    </div>

                    <!-- Two-Month Calendar Grid -->
                    <div class="calendar-grid">
                        <!-- July 2025 -->
                        <div class="month-container">
                            <div class="month-header">July 2025</div>
                            <div class="mini-calendar">
                                <!-- Day headers -->
                                {% for day in ['M', 'T', 'W', 'T', 'F', 'S', 'S'] %}
                                <div class="mini-day header">{{ day }}</div>
                                {% endfor %}
                                <!-- July days -->
                                <div class="mini-day other-month">30</div>
                                <div class="mini-day">1</div>
                                <div class="mini-day">2</div>
                                <div class="mini-day">3</div>
                                <div class="mini-day">4</div>
                                <div class="mini-day">5</div>
                                <div class="mini-day today">6</div>
                                <div class="mini-day">7</div>
                                <div class="mini-day">8</div>
                                <div class="mini-day">9</div>
                                <div class="mini-day">10</div>
                                <div class="mini-day">11</div>
                                <div class="mini-day">12</div>
                                <div class="mini-day">13</div>
                                <div class="mini-day">14</div>
                                <div class="mini-day">15</div>
                                <div class="mini-day">16</div>
                                <div class="mini-day">17</div>
                                <div class="mini-day">18</div>
                                <div class="mini-day">19</div>
                                <div class="mini-day">20</div>
                                <div class="mini-day">21</div>
                                <div class="mini-day">22</div>
                                <div class="mini-day">23</div>
                                <div class="mini-day">24</div>
                                <div class="mini-day">25</div>
                                <div class="mini-day">26</div>
                                <div class="mini-day">27</div>
                                <div class="mini-day">28</div>
                                <div class="mini-day">29</div>
                                <div class="mini-day">30</div>
                                <div class="mini-day">31</div>
                                <div class="mini-day other-month">1</div>
                                <div class="mini-day other-month">2</div>
                                <div class="mini-day other-month">3</div>
                            </div>
                        </div>

                        <!-- August 2025 -->
                        <div class="month-container">
                            <div class="month-header">August 2025</div>
                            <div class="mini-calendar">
                                <!-- Day headers -->
                                {% for day in ['M', 'T', 'W', 'T', 'F', 'S', 'S'] %}
                                <div class="mini-day header">{{ day }}</div>
                                {% endfor %}
                                <!-- August days -->
                                <div class="mini-day other-month">28</div>
                                <div class="mini-day other-month">29</div>
                                <div class="mini-day other-month">30</div>
                                <div class="mini-day other-month">31</div>
                                <div class="mini-day">1</div>
                                <div class="mini-day">2</div>
                                <div class="mini-day">3</div>
                                <div class="mini-day">4</div>
                                <div class="mini-day">5</div>
                                <div class="mini-day">6</div>
                                <div class="mini-day">7</div>
                                <div class="mini-day">8</div>
                                <div class="mini-day">9</div>
                                <div class="mini-day">10</div>
                                <div class="mini-day">11</div>
                                <div class="mini-day">12</div>
                                <div class="mini-day">13</div>
                                <div class="mini-day">14</div>
                                <div class="mini-day">15</div>
                                <div class="mini-day">16</div>
                                <div class="mini-day">17</div>
                                <div class="mini-day">18</div>
                                <div class="mini-day">19</div>
                                <div class="mini-day">20</div>
                                <div class="mini-day">21</div>
                                <div class="mini-day">22</div>
                                <div class="mini-day">23</div>
                                <div class="mini-day">24</div>
                                <div class="mini-day">25</div>
                                <div class="mini-day">26</div>
                                <div class="mini-day">27</div>
                                <div class="mini-day">28</div>
                                <div class="mini-day">29</div>
                                <div class="mini-day">30</div>
                                <div class="mini-day">31</div>
                            </div>
                        </div>
                    </div>

                    <!-- 5-Day Agenda -->
                    <div class="agenda-view">
                        {% if agenda_events and agenda_events|length > 0 %}
                            {% for day in agenda_events %}
                            <div class="agenda-day {% if day.is_today %}agenda-today{% endif %}">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">{{ day.date }}</div>
                                    <div class="agenda-day-name">{{ day.day_name }}</div>
                                </div>
                                <div class="agenda-events">
                                    {% if day.events and day.events|length > 0 %}
                                        {% for event in day.events %}
                                        <div class="agenda-event {% if event.type == 'all_day' %}agenda-all-day{% endif %}" 
                                             style="border-left-color: {{ event.calendar_color | default('#4285F4') }};">
                                            <div class="agenda-event-indicator" style="background-color: {{ event.calendar_color | default('#4285F4') }};"></div>
                                            <div class="agenda-event-content">
                                                <div class="agenda-event-time">
                                                    {% if event.start == 'All Day' or event.type == 'all_day' %}
                                                        All Day
                                                    {% else %}
                                                        {% if event.end and event.end != event.start %}
                                                            {{ event.start }}-{{ event.end }}
                                                        {% else %}
                                                            {{ event.start }}
                                                        {% endif %}
                                                    {% endif %}
                                                </div>
                                                <div class="agenda-event-title">{{ event.summary }}</div>
                                                <div class="agenda-event-calendar">{{ event.calendar_name | default('Calendar') }}</div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    {% else %}
                                        <div class="agenda-no-events">No events</div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <!-- Fallback agenda -->
                            <div class="agenda-day agenda-today">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">07/06</div>
                                    <div class="agenda-day-name">Today</div>
                                </div>
                                <div class="agenda-events">
                                    <div class="agenda-event agenda-all-day">
                                        <div class="agenda-event-time">All Day</div>
                                        <div class="agenda-event-title">Monthly review</div>
                                    </div>
                                </div>
                            </div>
                            <div class="agenda-day">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">07/07</div>
                                    <div class="agenda-day-name">Tomorrow</div>
                                </div>
                                <div class="agenda-events">
                                    <div class="agenda-event">
                                        <div class="agenda-event-time">08:30-09:00</div>
                                        <div class="agenda-event-title">NCSU orientation</div>
                                    </div>
                                </div>
                            </div>
                            <div class="agenda-day">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">07/08</div>
                                    <div class="agenda-day-name">Tuesday</div>
                                </div>
                                <div class="agenda-events">
                                    <div class="agenda-no-events">No events</div>
                                </div>
                            </div>
                            <div class="agenda-day">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">07/09</div>
                                    <div class="agenda-day-name">Wednesday</div>
                                </div>
                                <div class="agenda-events">
                                    <div class="agenda-no-events">No events</div>
                                </div>
                            </div>
                            <div class="agenda-day">
                                <div class="agenda-date">
                                    <div class="agenda-date-text">07/10</div>
                                    <div class="agenda-day-name">Thursday</div>
                                </div>
                                <div class="agenda-events">
                                    <div class="agenda-no-events">No events</div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Right Column - Weather Related Cards -->
            <div class="right-column">
                <!-- Hourly Forecast Chart Card -->
                <div class="card hourly-chart-card">
                    <h2 class="card-title">Today's Weather Trends</h2>
                    {% if weather and weather.hourly_forecast %}
                    <div class="hourly-chart-container">
                        <!-- Chart Area -->
                        <div class="chart-area">
                            <!-- Rain Probability Bars (Background) -->
                            <div class="rain-bars">
                                {% for hour in weather.hourly_forecast %}
                                <div class="rain-bar" style="height: {{ hour.pop }}%" title="Rain: {{ hour.pop }}%"></div>
                                {% endfor %}
                            </div>
                            
                            <!-- Temperature Line Chart (SVG Overlay) -->
                            <svg class="temp-line-chart" viewBox="0 0 800 200" preserveAspectRatio="none">
                                {% set temp_values = weather.hourly_forecast | map(attribute='temp') | list %}
                                {% set min_temp = temp_values | min %}
                                {% set max_temp = temp_values | max %}
                                {% set temp_range = max_temp - min_temp if max_temp != min_temp else 10 %}
                                
                                <!-- Generate SVG polyline points -->
                                {% set ns = namespace(points=[]) %}
                                {% for hour in weather.hourly_forecast %}
                                    {% set x = (loop.index0 * (800 / (weather.hourly_forecast|length - 1))) | round %}
                                    {% set y = (200 - ((hour.temp - min_temp) / temp_range) * 160 - 20) | round %}
                                    {% set _ = ns.points.append(x ~ ',' ~ y) %}
                                {% endfor %}
                                
                                <polyline points="{{ ns.points | join(' ') }}" 
                                         fill="none" 
                                         stroke="var(--text-accent)" 
                                         stroke-width="3"
                                         stroke-linecap="round"
                                         stroke-linejoin="round"/>
                                
                                <!-- Temperature data points -->
                                {% for hour in weather.hourly_forecast %}
                                    {% set x = (loop.index0 * (800 / (weather.hourly_forecast|length - 1))) | round %}
                                    {% set y = (200 - ((hour.temp - min_temp) / temp_range) * 160 - 20) | round %}
                                    <circle cx="{{ x }}" cy="{{ y }}" r="4" 
                                           fill="var(--text-accent)" 
                                           stroke="var(--bg-dark)" 
                                           stroke-width="2"/>
                                {% endfor %}
                            </svg>
                        </div>
                        
                        <!-- X-Axis Labels and Data -->
                        <div class="chart-x-axis">
                            {% for hour in weather.hourly_forecast %}
                            <div class="x-axis-item">
                                <div class="axis-time">{{ hour.time }}</div>
                                <div class="axis-icon">
                                    {% if hour.icon %}
                                    <img src="https://openweathermap.org/img/wn/{{ hour.icon }}.png"
                                         alt="{{ hour.description }}" class="weather-icon-small">
                                    {% else %}
                                    <span class="weather-emoji">‚òÄÔ∏è</span>
                                    {% endif %}
                                </div>
                                <div class="axis-temp">{{ hour.temp }}¬∞</div>
                                <div class="axis-details">
                                    <span class="wind">{{ hour.wind_speed }}mph</span>
                                    <span class="humidity">{{ hour.humidity }}%</span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% else %}
                    <div class="hourly-chart-container">
                        <p class="no-data">Hourly forecast not available</p>
                    </div>
                    {% endif %}
                </div>

                <!-- 5-Day Forecast Card -->
                <div class="card forecast-card">
                    <h2 class="card-title">5-Day Outlook</h2>
                    <div class="forecast-container">
                        {% if forecast and forecast|length > 0 %}
                            {% for day in forecast[:5] %}
                            <div class="forecast-item">
                                <div class="forecast-day-name">{{ day.day | default('Today') }}</div>
                                {% if day.icon %}
                                <img src="https://openweathermap.org/img/wn/{{ day.icon }}@2x.png"
                                     alt="{{ day.description }}" class="forecast-icon-small">
                                {% else %}
                                <div class="forecast-icon-small">‚òÄÔ∏è</div>
                                {% endif %}
                                <div class="forecast-desc">{{ day.description | default('Sunny') }}</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: {{ day.low | default('65') }}; --high: {{ day.high | default('78') }}; --week-min: {{ week_temp_min | default('60') }}; --week-range: {{ week_temp_range | default('25') }};"
                                             aria-label="Low {{ day.low | default('65') }} degrees, High {{ day.high | default('78') }} degrees">
                                            <span class="visually-hidden">{{ day.low | default('65') }}¬∞</span>
                                            <span class="visually-hidden">{{ day.high | default('78') }}¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">{{ day.low | default('65') }}¬∞</span>
                                        <span class="forecast-high">{{ day.high | default('78') }}¬∞</span>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <!-- Fallback forecast data -->
                            <div class="forecast-item">
                                <div class="forecast-day-name">Today</div>
                                <div class="forecast-icon-small">‚òÄÔ∏è</div>
                                <div class="forecast-desc">Sunny and clear</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: 65; --high: 78; --week-min: 62; --week-range: 18;"
                                             aria-label="Low 65 degrees, High 78 degrees">
                                            <span class="visually-hidden">65¬∞</span>
                                            <span class="visually-hidden">78¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">65¬∞</span>
                                        <span class="forecast-high">78¬∞</span>
                                    </div>
                                </div>
                            </div>
                            <div class="forecast-item">
                                <div class="forecast-day-name">Tomorrow</div>
                                <div class="forecast-icon-small">üåßÔ∏è</div>
                                <div class="forecast-desc">Light showers</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: 62; --high: 70; --week-min: 62; --week-range: 18;"
                                             aria-label="Low 62 degrees, High 70 degrees">
                                            <span class="visually-hidden">62¬∞</span>
                                            <span class="visually-hidden">70¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">62¬∞</span>
                                        <span class="forecast-high">70¬∞</span>
                                    </div>
                                </div>
                            </div>
                            <div class="forecast-item">
                                <div class="forecast-day-name">Monday</div>
                                <div class="forecast-icon-small">‚õÖ</div>
                                <div class="forecast-desc">Partly cloudy</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: 64; --high: 75; --week-min: 62; --week-range: 18;"
                                             aria-label="Low 64 degrees, High 75 degrees">
                                            <span class="visually-hidden">64¬∞</span>
                                            <span class="visually-hidden">75¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">64¬∞</span>
                                        <span class="forecast-high">75¬∞</span>
                                    </div>
                                </div>
                            </div>
                            <div class="forecast-item">
                                <div class="forecast-day-name">Tuesday</div>
                                <div class="forecast-icon-small">‚òÄÔ∏è</div>
                                <div class="forecast-desc">Bright and sunny</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: 68; --high: 80; --week-min: 62; --week-range: 18;"
                                             aria-label="Low 68 degrees, High 80 degrees">
                                            <span class="visually-hidden">68¬∞</span>
                                            <span class="visually-hidden">80¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">68¬∞</span>
                                        <span class="forecast-high">80¬∞</span>
                                    </div>
                                </div>
                            </div>
                            <div class="forecast-item">
                                <div class="forecast-day-name">Wednesday</div>
                                <div class="forecast-icon-small">‚õÖ</div>
                                <div class="forecast-desc">Mixed clouds</div>
                                <div class="forecast-temp-container">
                                    <div class="temp-bar-container">
                                        <div class="temp-bar"
                                             style="--low: 66; --high: 77; --week-min: 62; --week-range: 18;"
                                             aria-label="Low 66 degrees, High 77 degrees">
                                            <span class="visually-hidden">66¬∞</span>
                                            <span class="visually-hidden">77¬∞</span>
                                        </div>
                                    </div>
                                    <div class="forecast-temp-range">
                                        <span class="forecast-low">66¬∞</span>
                                        <span class="forecast-high">77¬∞</span>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Travel Card -->
                <div class="card local-info-card">
                    <h2 class="card-title">Travel</h2>

                    <!-- Traffic Map Section -->
                    <div class="traffic-section">
                        <div class="traffic-label">Traffic Conditions</div>
                        <div class="traffic-map-container">
                            {% if mapbox_map_url %}
                            <!-- Mapbox static image with traffic -->
                            <img class="traffic-map" 
                                 src="{{ mapbox_map_url }}"
                                 alt="Traffic Map"
                                 loading="lazy">
                            {% elif google_maps_api_key %}
                            <!-- Google Maps fallback -->
                            <iframe class="traffic-map" 
                                    src="https://www.google.com/maps/embed/v1/view?key={{ google_maps_api_key }}&center={{ traffic_map.center_lat }},{{ traffic_map.center_lng }}&zoom={{ traffic_map.zoom }}&maptype={{ traffic_map.map_type }}&traffic"
                                    allowfullscreen>
                            </iframe>
                            {% else %}
                            <!-- Basic fallback -->
                            <iframe class="traffic-map" 
                                    src="https://www.google.com/maps?q={{ traffic_map.center_lat }},{{ traffic_map.center_lng }}&z={{ traffic_map.zoom }}&t=m&layer=t&output=embed"
                                    allowfullscreen>
                            </iframe>
                            {% endif %}
                        </div>
                        
                        <!-- Travel Times Section -->
                        {% if travel_times and travel_times|length > 0 %}
                        <div class="travel-times">
                            <div class="travel-times-label">Travel Times</div>
                            {% for travel_time in travel_times %}
                            <div class="travel-time-item">
                                <div class="destination-info">
                                    <span class="destination-name">{{ travel_time.destination }}</span>
                                    <span class="traffic-status">{{ travel_time.traffic_status }}</span>
                                </div>
                                <div class="travel-duration">{{ travel_time.duration_text }}</div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- News/Events Ticker -->
        <div class="news-section">
            <!-- News Ticker -->
            <div class="ticker-section">
                <div class="ticker-label news-ticker-label">Live News</div>
                <div class="ticker-scroll" id="newsTicker">
                    {% if articles and articles|length > 0 %}
                        {% for article in articles %}
                        <span class="ticker-item">
                            <span class="news-tag">[{{ article.source }}]</span>
                            {{ article.title }}
                        </span>
                        {% endfor %}
                    {% else %}
                        <!-- Fallback news -->
                        <span class="ticker-item">
                            <span class="news-tag">[BBC]</span>
                            Global climate summit reaches breakthrough agreement on carbon reduction targets
                        </span>
                        <span class="ticker-item">
                            <span class="news-tag">[TECH]</span>
                            New JavaScript framework promises 90% smaller bundle sizes with zero-config setup
                        </span>
                        <span class="ticker-item">
                            <span class="news-tag">[LOCAL]</span>
                            Winston-Salem announces new downtown development project
                        </span>
                    {% endif %}
                </div>
            </div>

            <!-- Calendar Events Ticker -->
            <div class="ticker-section calendar-ticker">
                <div class="ticker-label calendar-ticker-label">Upcoming Events</div>
                <div class="ticker-scroll calendar-ticker-scroll">
                    {% if upcoming_events and upcoming_events|length > 0 %}
                        {% for event in upcoming_events %}
                        <span class="ticker-item">
                            <span class="calendar-event">{{ event.date }}:</span>
                            <span class="event-date">{{ event.summary }}</span>
                        </span>
                        {% endfor %}
                    {% else %}
                        <!-- Fallback upcoming events -->
                        <span class="ticker-item">
                            <span class="calendar-event">Jul 4:</span>
                            <span class="event-date">Independence Day</span>
                        </span>
                        <span class="ticker-item">
                            <span class="calendar-event">Jul 15:</span>
                            <span class="event-date">Company All-Hands Meeting</span>
                        </span>
                        <span class="ticker-item">
                            <span class="calendar-event">Jul 20:</span>
                            <span class="event-date">Team Building Retreat</span>
                        </span>
                        <span class="ticker-item">
                            <span class="calendar-event">Jul 28:</span>
                            <span class="event-date">Q3 Planning Workshop</span>
                        </span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update time every second (keep existing functionality)
        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: false
            });
            const timeEl = document.querySelector('.current-time');
            if (timeEl) {
                timeEl.textContent = timeStr;
            }

            const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                'July', 'August', 'September', 'October', 'November', 'December'];

            const dateEl = document.querySelector('.current-date');
            if (dateEl) {
                dateEl.textContent = dayNames[now.getDay()] + ', ' + monthNames[now.getMonth()] + ' ' + now.getDate();
            }
        }

        // Weather Alert Testing Functions
        function createTestAlert(type = 'default', event = 'Heat Advisory', description = 'Excessive heat warning in effect. Temperatures may reach dangerous levels.') {
            // Remove existing test alert
            removeTestAlert();

            const alertBanner = document.createElement('div');
            alertBanner.className = `weather-alert-banner test-alert ${type}`;
            alertBanner.id = 'test-alert-banner';

            const now = new Date();
            const startTime = now.toLocaleDateString('en-US', {month: 'numeric', day: 'numeric'}) + ' ' +
                             now.toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: false});
            const endTime = new Date(now.getTime() + 6 * 60 * 60 * 1000).toLocaleDateString('en-US', {month: 'numeric', day: 'numeric'}) + ' ' +
                           new Date(now.getTime() + 6 * 60 * 60 * 1000).toLocaleTimeString('en-US', {hour: 'numeric', minute: '2-digit', hour12: false});

            alertBanner.innerHTML = `
                <div class="alert-content">
                    <span class="alert-icon">‚ö†Ô∏è</span>
                    <span class="alert-event">${event}</span>
                    <span class="alert-time">${startTime} - ${endTime}</span>
                </div>
                <div class="alert-description">${description}</div>
            `;

            document.body.insertBefore(alertBanner, document.body.firstChild);
        }

        function removeTestAlert() {
            const existing = document.getElementById('test-alert-banner');
            if (existing) {
                existing.remove();
            }
        }

        // Check URL parameters for test alerts
        function checkTestParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const testAlert = urlParams.get('test-alert');

            if (testAlert) {
                switch(testAlert.toLowerCase()) {
                    case 'severe':
                        createTestAlert('severe', 'Tornado Warning', 'Tornado warning in effect for Winston-Salem and surrounding areas. Take shelter immediately.');
                        break;
                    case 'warning':
                        createTestAlert('warning', 'Severe Thunderstorm Warning', 'Severe thunderstorm warning with damaging winds and large hail possible.');
                        break;
                    case 'heat':
                        createTestAlert('warning', 'Heat Advisory', 'Excessive heat warning in effect. Heat index values up to 110 degrees expected.');
                        break;
                    case 'winter':
                        createTestAlert('severe', 'Winter Storm Warning', 'Heavy snow and ice expected. Travel will be extremely dangerous or impossible.');
                        break;
                    case 'flood':
                        createTestAlert('warning', 'Flood Watch', 'Flooding possible due to excessive rainfall. Monitor local conditions and avoid flooded roads.');
                        break;
                    default:
                        createTestAlert('default', 'Weather Advisory', 'General weather advisory in effect for the local area.');
                }
            }
        }

        // Keyboard shortcuts for testing (Ctrl + Alt + number)
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.altKey) {
                switch(e.key) {
                    case '1':
                        createTestAlert('default', 'Weather Advisory', 'General weather advisory in effect for the local area.');
                        e.preventDefault();
                        break;
                    case '2':
                        createTestAlert('warning', 'Heat Advisory', 'Excessive heat warning in effect. Heat index values up to 110 degrees expected.');
                        e.preventDefault();
                        break;
                    case '3':
                        createTestAlert('severe', 'Tornado Warning', 'Tornado warning in effect for Winston-Salem and surrounding areas. Take shelter immediately.');
                        e.preventDefault();
                        break;
                    case '0':
                        removeTestAlert();
                        e.preventDefault();
                        break;
                }
            }
        });

        // Update immediately and then every second
        updateTime();
        setInterval(updateTime, 1000);

        // Check for test parameters on load
        checkTestParams();
    </script>
</body>
</html>
